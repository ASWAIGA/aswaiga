<p style="color: green"><%= notice %></p>

<div class= "issue-parte arriba">
  <header class= "issue-cabecera">
    <header>
      <h1>Issues</h1>
    </header>
    <div id= "contenidor">
      <p>
        <div class="opciones issue">
          <button class="btn-filter" id="filters-button">
            <img class="filters-icon" src="/img/Icon-filter.png" alt="Filters" style=""width: 50px;"">
            <span>Filters</span>
          </button>
        </div>
      </p>
      <p>
        <div class= "search-container">
          <input type="text" class="tg-input-search" placeholder="subject or reference">
          <img src="/img/Icon-search.png" alt="icono" class="search-icon">
        </div>
      </p>
      <p>
        <label class= "tag-switch">
            <input type="checkbox" id="mySwitch" onclick="myFunction()" class="checkbox-tags">
            <span class="slider"></span>
        </label>
      </p>
      <span style="display: inline-block; margin-left: 50px;">Tags</span>
      <%= link_to "+ NEW ISSUE", new_issue_path, class:"btn btn-success" %>
      <button class="boton-new-bulk">
        <img class="img-new-bulk" src="/img/Icon-new-bulk-white.png"/>
      </button>


    </div>
  </header>
</div>

<script>
function myFunction() {
  var checkBox = document.getElementById("mySwitch");
  if (checkBox.checked == true){
  } else {
  }
}
</script>


<div id="issues">
  <table class="table table-striped table-borderless">
    <thead>
      <tr>
        <th>TYPE</th>
        <th>SEVERITY</th>
        <th>PRIORITY</th>
        <th>ISSUE</th>
        <th>STATUS</th>
        <th>MODIFIED</th>
        <th>ASSIGN TO</th>
      </tr>
    </thead>
    <% @issues.each do |issue| %>
    <tbody>
      <tr>
        <td><%= issue.tipus %></td>
        <td><%= issue.severity %></td>
        <td><%= issue.priority %></td>
        <td><%= link_to issue.issue, issue%> <img id="clockid-<%= issue.id %>" class="clock-icon" src="" alt=""></td>
        <script>
          if (<%= issue.due_date.present?.to_json %>) {
            const dueDate = '<%= issue.due_date %>';
            const clock = document.getElementById("clockid-" + <%= issue.id.to_s %>);
            const today = new Date();
            const dueDateObj = new Date(dueDate);

            const timeDiff = dueDateObj.getTime() - today.getTime();
            const diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24));

            if (diffDays <= 0) {
              clock.src = "/img/Icon-clock-red.png";
            }
            else if (diffDays <= 15) {
              clock.src = "/img/Icon-clock-orange.png";
            }
            else {
              clock.src = "/img/Icon-clock-green.png";
            }
          }

          else {
            const clock = document.getElementById("clockid-" + <%= issue.id.to_s %>);
            clock.src = "/img/Icon-no-clock.png";
          }
        </script>
        <td><%= issue.status %></td>
        <td><%= issue.updated_at.strftime("%d %b %Y") %></td>
        <td><%= issue.assign_to %></td>
      </tr>
    </tbody>
    <% end %>
  </table>
</div>